<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>保存、读取数据 | 来自遥远星系的技术空间站</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/4.1.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.6.2/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/2.2.3/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">保存、读取数据</h1><a id="logo" href="/.">来自遥远星系的技术空间站</a><p class="description"></p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 博客</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/comment/"><i class="fa fa-comments"> 留言</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">保存、读取数据</h1><div class="post-meta">Jul 9, 2016<span> | </span><span class="category"><a href="/categories/iOS/">iOS</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a data-disqus-identifier="2016/07/09/Saving_and_Loading/" href="/2016/07/09/Saving_and_Loading/#disqus_thread" class="disqus-comment-count"></a><div class="post-content"><h1 id="固化"><a href="#固化" class="headerlink" title="固化"></a>固化</h1><p>对于大多数iOS 应用，可以将其功能总结为：提供一套界面，帮助用户管理特定的数据。在这一过程中，可以采取较为常用的<br>MVC设计模型（不同类型的对象要各司其职：模型对象负责保存数据，视图对象负责显示数据，控制器对象负责在模型对象与视图对象之间同步数据）。因此，在我们需要保存和读取数据的时候，首要的目的便是建立相应的模型对象。</p>
<p><strong>固化</strong>是由iOS SDK 提供的一种保存和读取对象的机制。当我们的应用程序固化某一个对象的时候，会将该对象的所有属性存入指定的文件。然而当程序解固某个对象的时候，会从指定的文件读取相应的数据，然后根据数据还原对象。</p>
<p>下面这里以具体的代码为例子：</p>
<p>使用固化功能需要遵守<nscoding>协议，并且实现两个方法：</nscoding></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- (void)encodeWithCoder:(NSCoder *)aCoder;  //对数据进行编码</span><br><span class="line">- (instancetype)initWithCoder:(NSCoder *)aDecoder;  //还原数据的编码</span><br></pre></td></tr></table></figure>
<p>并且创建一个Model类，有如下属性：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@interface model : NSObject &lt;NSCoding&gt;</span><br><span class="line"></span><br><span class="line">@property (nonatomic, copy) NSString * name;</span><br><span class="line">@property (nonatomic, copy) NSString * detail;</span><br><span class="line">@property (nonatomic, assign) NSInteger ID;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>并且在Model类中实现上述的两种方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">- (void)encodeWithCoder:(NSCoder *)aCoder &#123;</span><br><span class="line">    //将各个属性编码，以便保存</span><br><span class="line">    // 如果属性是对象类型(NSString)的就用  encodeObject:forKey 方法来编码</span><br><span class="line">    //如果属性是基础类型(NSInteger)的就用  encodeInteger:forKey 方法来编码 </span><br><span class="line">    //具体用哪一个方法来编码，可以进入NSCoder对象中查看</span><br><span class="line">    [aCoder encodeObject:self.name forKey:@&quot;modelName&quot;];</span><br><span class="line">    [aCoder encodeObject:self.detail forKey:@&quot;modelDetail&quot;];</span><br><span class="line">    [aCoder encodeInteger:self.ID forKey:@&quot;modelID&quot;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (instancetype)initWithCoder:(NSCoder *)aDecoder &#123;</span><br><span class="line">    self = [super init];</span><br><span class="line">    if (self) &#123;</span><br><span class="line">        //对数据进行解码</span><br><span class="line">        _name = [aDecoder decodeObjectForKey:@&quot;modelName&quot;];</span><br><span class="line">        _detail = [aDecoder decodeObjectForKey:@&quot;modelDetail&quot;];</span><br><span class="line">        _ID = [aDecoder decodeIntegerForKey:@&quot;modelID&quot;];</span><br><span class="line">    &#125;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="应用沙盒"><a href="#应用沙盒" class="headerlink" title="应用沙盒"></a>应用沙盒</h1><p>上述通过建立了一个Model 对象遵守NSCoding 协议，可以通过固化机制来保存和读取它。然而在构建应用之后，我们的对象保存在哪里呢？这里就需要介绍一下<strong>应用沙盒</strong>了。</p>
<p>每一个iOS 应用都有属于自己的应用沙盒。其实这里所说的沙盒就是文件系统中的目录，但是iOS 系统会将每个应用的沙盒目录于文件系统的其他部分隔离。</p>
<p>这里就有一个iOS 很重要的安全问题了<em>每一个应用的必须待在自己的沙盒里面，并且只能访问自己的沙盒</em></p>
<p>这里可以通过<a href="https://developer.apple.com/library/mac/documentation/FileManagement/Conceptual/FileSystemProgrammingGuide/FileSystemOverview/FileSystemOverview.html" target="_blank" rel="external">文档</a> 来知道自己应用的沙盒。</p>
<p>一般程序应用的沙盒都有三个文件夹：Documents、Library、temp以及一个.app包。</p>
<ul>
<li><p><strong>Documents 目录：</strong>您应该将所有的应用程序数据文件写入到这个目录下。这个目录用于存储用户数据。该路径可通过配置实现iTunes共享文件。可被iTunes备份。</p>
</li>
<li><p><strong>AppName.app 目录：</strong>这是应用程序的程序包目录，包含应用程序的本身。由于应用程序必须经过签名，所以您在运行时不能对这个目录中的内容进行修改，否则可能会使应用程序无法启动。</p>
</li>
<li><p><strong>Library 目录：</strong>这个目录下有两个子目录：</p>
<ol>
<li><strong>Preferences 目录：</strong>包含应用程序的偏好设置文件。您不应该直接创建偏好设置文件，而是应该使用NSUserDefaults类来取得和设置应用程序的偏好.</li>
<li><strong>Caches 目录：</strong>用于存放应用程序专用的支持文件，保存应用程序再次启动过程中需要的信息。<br>可创建子文件夹。可以用来放置您希望被备份但不希望被用户看到的数据。该路径下的文件夹，除Caches以外，都会被iTunes备份。</li>
</ol>
</li>
<li><p><strong>tmp 目录：</strong>这个目录用于存放临时文件，保存应用程序再次启动过程中不需要的信息。该路径下的文件不会被iTunes备份。</p>
</li>
</ul>
<h3 id="获取文件路径"><a href="#获取文件路径" class="headerlink" title="获取文件路径"></a>获取文件路径</h3><p>其主要方法有这些：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// 获取沙盒主目录路径</span><br><span class="line">NSString *homeDir = NSHomeDirectory();</span><br><span class="line">// 获取Documents目录路径</span><br><span class="line">NSString *docDir = [NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES) firstObject];</span><br><span class="line">// 获取Library的目录路径</span><br><span class="line">NSString *libDir = [NSSearchPathForDirectoriesInDomains(NSLibraryDirectory, NSUserDomainMask, YES) lastObject];</span><br><span class="line">// 获取Caches目录路径</span><br><span class="line">NSString *cachesDir = [NSSearchPathForDirectoriesInDomains(NSCachesDirectory, NSUserDomainMask, YES) firstObject];</span><br><span class="line">// 获取tmp目录路径</span><br><span class="line">NSString *tmpDir =  NSTemporaryDirectory();</span><br></pre></td></tr></table></figure>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://dbcxl.com/2016/07/09/Saving_and_Loading/" data-id="cizzmgb0j00213psbcwu90vxo" class="article-share-link">分享到</a><div class="tags"><a href="/tags/文件I-O/">文件I/O</a></div><div class="post-nav"><a href="/2016/07/19/AFNetworking/" class="pre">浅析AFNetworking（一）</a><a href="/2016/07/03/NSNotificationCenter/" class="next">NSNotificationCenter (通知中心)</a></div><div id="disqus_thread"><script>var disqus_shortname = 'dbcxl';
var disqus_identifier = '2016/07/09/Saving_and_Loading/';
var disqus_title = '保存、读取数据';
var disqus_url = 'http://dbcxl.com/2016/07/09/Saving_and_Loading/';
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//dbcxl.disqus.com/count.js" async></script></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://dbcxl.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/iOS/">iOS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/前端/">前端</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/计算机基础/">计算机基础</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/消息传递/" style="font-size: 15px;">消息传递</a> <a href="/tags/AFNetworking/" style="font-size: 15px;">AFNetworking</a> <a href="/tags/面向对象/" style="font-size: 15px;">面向对象</a> <a href="/tags/BugFix/" style="font-size: 15px;">BugFix</a> <a href="/tags/Foundation框架/" style="font-size: 15px;">Foundation框架</a> <a href="/tags/计算机网络/" style="font-size: 15px;">计算机网络</a> <a href="/tags/Git/" style="font-size: 15px;">Git</a> <a href="/tags/Nginx/" style="font-size: 15px;">Nginx</a> <a href="/tags/TCP-IP/" style="font-size: 15px;">TCP/IP</a> <a href="/tags/动画/" style="font-size: 15px;">动画</a> <a href="/tags/文件I-O/" style="font-size: 15px;">文件I/O</a> <a href="/tags/UI控件/" style="font-size: 15px;">UI控件</a> <a href="/tags/LAMP/" style="font-size: 15px;">LAMP</a> <a href="/tags/charles/" style="font-size: 15px;">charles</a> <a href="/tags/markdown/" style="font-size: 15px;">markdown</a> <a href="/tags/pug/" style="font-size: 15px;">pug</a> <a href="/tags/react-native/" style="font-size: 15px;">react-native</a> <a href="/tags/Style-Guide/" style="font-size: 15px;">Style Guide</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/03/03/coreAnimation/">核心动画(Core Animation)</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/05/react-native/">React - Native 学习(一)</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/04/charles/">Charles 入门</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/13/InternetReview1/">TCP/IP学习笔记（二）</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/12/InternetReview/">TCP/IP学习笔记（一）</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/28/styleGuide/">Objective-C Style Guide</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/22/BugFix/">Undefined symbols for architecture x86_64等的完整解决方案</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/12/pugAndSass/">pug和sass的使用教程</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/08/Properties/">属性(Properties)</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/19/AFNetworking/">浅析AFNetworking（一）</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-comment-o"> 最近评论</i></div><script type="text/javascript" src="//dbcxl.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=1"></script></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://llissery.net/" title="llissery的博客" target="_blank">llissery的博客</a><ul></ul><a href="http://hyuni.cn/" title="hyuni的博客" target="_blank">hyuni的博客</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a rel="nofollow" target="_blank" href="https://github.com/KnightJoker">KnightJoker.</a>Touching my heart.</div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>